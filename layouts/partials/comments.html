<script src="https://giscus.app/client.js"
  data-repo="{{ .Site.Params.giscus.repo }}"
  data-repo-id="{{ .Site.Params.giscus.repoId }}"
  data-category="{{ .Site.Params.giscus.category }}"
  data-category-id="{{ .Site.Params.giscus.categoryId }}"
  data-mapping="{{ .Site.Params.giscus.mapping }}"
  data-reactions-enabled="1"
  data-emit-metadata="0"
  data-theme="preferred_color_scheme"
  data-lang="{{ .Site.Params.giscus.lang }}"
  crossorigin="anonymous"
  async>
</script>

<script>
  function updateGiscusTheme() {
    const isDark = document.body.classList.contains('dark');
    const theme = isDark ? 'dark' : 'light';
    const iframe = document.querySelector('iframe.giscus-frame');
    if (iframe) {
      iframe.contentWindow.postMessage(
        { giscus: { setConfig: { theme } } },
        'https://giscus.app'
      );
    }
  }

  // 监听 PaperMod 的主题切换按钮
  const themeToggle = document.getElementById('theme-toggle');
  if (themeToggle) {
    themeToggle.addEventListener('click', () => {
      // 等待 PaperMod 切换完 class 再同步
      setTimeout(updateGiscusTheme, 100);
    });
  }

  // 页面加载完成后也同步一次
  window.addEventListener('load', updateGiscusTheme);
</script>