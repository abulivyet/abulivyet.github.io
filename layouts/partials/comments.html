<script src="https://giscus.app/client.js"
  data-repo="{{ .Site.Params.giscus.repo }}"
  data-repo-id="{{ .Site.Params.giscus.repoId }}"
  data-category="{{ .Site.Params.giscus.category }}"
  data-category-id="{{ .Site.Params.giscus.categoryId }}"
  data-mapping="{{ .Site.Params.giscus.mapping }}"
  data-reactions-enabled="1"
  data-emit-metadata="0"
  data-theme="preferred_color_scheme"
  data-lang="{{ .Site.Params.giscus.lang }}"
  crossorigin="anonymous"
  async>
</script>

<script>
  function setGiscusTheme(theme) {
    const iframe = document.querySelector('iframe.giscus-frame');
    if (!iframe) return;
    iframe.contentWindow.postMessage(
      { giscus: { setConfig: { theme: theme } } },
      'https://giscus.app'
    );
  }

  const observer = new MutationObserver(() => {
    const isDark = document.body.classList.contains('dark');
    setGiscusTheme(isDark ? 'dark' : 'light');
  });

  observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });
</script>